function toggleCartVisibility(){let t=document.getElementById("listCart");t?(t.classList.toggle("hidden"),t.classList.contains("hidden")||showCart()):console.error("Element with ID 'listCart' not found")}function rmvClick(){let t=this.getAttribute("data-product-id"),e=this.getAttribute("data-product-flavour"),r=this.getAttribute("data-product-weight");removeItemVariant(t,e,r)}function showCart(){let t=new URLSearchParams;t.append("action","show"),fetch("cartServlet?"+t.toString()).then(t=>{if(!t.ok)throw Error(`Network error: ${t.status} - ${t.statusText}`);return t.text()}).then(t=>{updateCartView("show",t),window.location.pathname.includes("Carrello")&&updateCartJSP(t)}).catch(t=>{console.error(t)})}function updateCartView(t,e){try{e||(e="[]");let r=JSON.parse(e),n=document.getElementById("listCart");if(!n){console.error("Element with ID 'listCart' not found");return}if(n.innerHTML="",0===r.length){let a=document.createElement("div");a.innerText="Il carrello \xe8 vuoto.",n.appendChild(a);let o=document.getElementById("cart");o.innerText="Carrello (0)";return}let i=0,l=0;for(let d=0;d<r.length-1;d++){let c=r[d],s=document.createElement("div");s.innerText=`${c.nomeProdotto} ${c.quantity} ${c.prezzo}€`;let u=document.createElement("button");u.className="rmvButton",u.innerText="Rimuovi Elemento",u.style.display="block",u.style.color="white",u.setAttribute("data-product-id",c.idProdotto),u.setAttribute("data-product-flavour",c.flavour),u.setAttribute("data-product-weight",c.weight),u.addEventListener("click",rmvClick),s.appendChild(u),n.appendChild(s),i+=c.quantity}let p=r[r.length-1];l=p.totalPrice;let h=document.getElementById("cart");if(!h){console.error("Element with ID 'cart' not found");return}h.innerHTML=`Carrello (${i})`;let C=document.createElement("h3");C.innerText=`Totale carrello: ${l}€`,n.appendChild(C);let m=document.createElement("div"),g=document.createElement("button");g.className="checkOut",g.innerText="Vai al CheckOut",g.onclick=function(){window.location.href="Carrello.jsp"},m.appendChild(g),n.appendChild(m)}catch(w){console.error("Error parsing JSON response:",w),console.log("Response text:",e)}}function addCartVariant(t,e,r,n){let a=new URLSearchParams;a.append("action","addVariant"),a.append("id",t),e&&a.append("quantity",e),a.append("gusto",r),a.append("pesoConfezione",n),fetch("cartServlet?"+a.toString()).then(t=>{if(!t.ok)throw Error(`Network error: ${t.status} - ${t.statusText}`);return t.text()}).then(t=>{updateCartView("add",t)}).catch(t=>{console.error(t)})}function removeItemVariant(t,e,r){let n=new URLSearchParams;n.append("action","removeVariant"),n.append("id",t),n.append("gusto",e),n.append("pesoConfezione",r),fetch("cartServlet?"+n.toString()).then(t=>{if(!t.ok)throw Error(`Network error: ${t.status} - ${t.statusText}`);return t.text()}).then(t=>{updateCartView("remove",t),showCart(),window.location.pathname.includes("cart")&&(console.log("Stong ndo cart"),showCartCheckOut())}).catch(t=>{console.error(t)})}document.addEventListener("DOMContentLoaded",function(){document.getElementById("cart").addEventListener("click",function(){toggleCartVisibility()}),showCart()});